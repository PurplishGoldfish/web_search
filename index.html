<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pancake Safe Search</title>
<style>
body { font-family: system-ui, sans-serif; max-width: 700px; margin: auto; padding: 2rem; }
h1 { text-align: center; color: #ff7f00; }
form { display: flex; justify-content: center; margin-bottom: 1rem; }
input { flex: 1; padding: 0.5rem; border-radius: 8px 0 0 8px; border: 1px solid #ccc; }
button { padding: 0.5rem 1rem; border: none; background: #ff7f00; color: white; border-radius: 0 8px 8px 0; cursor: pointer; }
button:hover { background: #e56f00; }
.result { margin-top: 0.5rem; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; background: white; }
.result a { text-decoration: none; color: #0073e6; font-weight: bold; }
.result a:hover { text-decoration: underline; }
</style>
</head>
<body>
<h1>ðŸ¥ž Pancake Safe Search</h1>
<form id="searchForm">
<input type="text" id="query" placeholder="Search the web..." required>
<button type="submit">Search</button>
</form>
<div id="results"></div>

<script>
const resultsDiv = document.getElementById('results');

async function search(query) {
  resultsDiv.innerHTML = '<p>Searching...</p>';

  const url = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://duckduckgo.com/html/?q=' + query);

  try {
    const res = await fetch(url);
    const text = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, 'text/html');

    const anchors = [...doc.querySelectorAll('a.result__a')];
    if (anchors.length === 0) {
      resultsDiv.innerHTML = '<p>No results found.</p>';
      return;
    }

    resultsDiv.innerHTML = '';
    anchors.slice(0, 10).forEach(a => {
      let href = a.href;
      const match = href.match(/uddg=([^&]+)/);
      if (match) href = decodeURIComponent(match[1]);

      checkIframeSafe(href, a.innerText);
    });
  } catch (err) {
    resultsDiv.innerHTML = `<p>Error: ${err.message}</p>`;
  }
}

function checkIframeSafe(url, title) {
  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = url;

  const timeout = setTimeout(() => {
    iframe.remove();
  }, 5000);

  iframe.onload = () => {
    clearTimeout(timeout);
    const div = document.createElement('div');
    div.className = 'result';
    div.innerHTML = `<a href="${url}" target="_self">${title}</a>`;
    resultsDiv.appendChild(div);
    iframe.remove();
  };

  iframe.onerror = () => {
    clearTimeout(timeout);
    iframe.remove(); // do not display blocked sites
  };

  document.body.appendChild(iframe);
}

document.getElementById('searchForm').addEventListener('submit', e => {
  e.preventDefault();
  const q = document.getElementById('query').value.trim();
  if (q) search(q);
});
</script>
</body>
</html>
